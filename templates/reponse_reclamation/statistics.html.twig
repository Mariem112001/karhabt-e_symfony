{% extends 'baseBack.html.twig' %}

{% block title %}Statistiques des réclamations{% endblock %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-md-10 offset-md-1">
                <div class="card">
                    <div class="card-header">
                        <h1 class="card-title text-center">Statistiques des réclamations</h1>
                    </div>
                    <div class="text-center mt-4">
                            <button class="btn btn-primary" id="download-csv">Télécharger</button>
                        </div>
                    <div class="card-body">
                        <div class="chart-container" style="position: relative; height:70vh; width:60vw;">
                            <canvas id="reclamation-chart"></canvas>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ asset('back/vendor/chart.js/Chart.min.js') }}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var statisticsData = {{ statisticsData|json_encode|raw }};
            var dates = [];
            var counts = [];
            
            statisticsData.forEach(function(item) {
                dates.push(item.date);
                counts.push(item.count);
            });

            var ctx = document.getElementById('reclamation-chart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates.map(function(date) {
                        return new Date(date).toLocaleDateString();
                    }),
                    datasets: [{
                        label: 'Nombre de réclamations',
                        data: counts,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                fontSize: 12 // Taille de police pour l'axe Y
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Nombre de réclamations',
                                fontSize: 14 // Taille de police pour le libellé de l'axe Y
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontSize: 12 // Taille de police pour l'axe X
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Dates',
                                fontSize: 14 // Taille de police pour le libellé de l'axe X
                            }
                        }]
                    },
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            fontColor: '#333', // Couleur de police pour la légende
                            fontSize: 14 // Taille de police pour la légende
                        }
                    },
                    title: {
                        display: false // Désactiver le titre du graphique
                    }
                }
            });

// Fonction pour télécharger les données au format CSV
document.getElementById('download-csv').addEventListener('click', function() {
    var csvContent = "data:text/csv;charset=utf-8,";
    csvContent += "Date;Nombre de réclamations\n";
    for (var i = 0; i < dates.length; i++) {
        var date = new Date(dates[i]).toLocaleDateString();
        var count = counts[i].toLocaleString(); // Ajoutez cette ligne pour formater le nombre avec des séparateurs de milliers
        csvContent += "\"" + date + "\";" + count + "\n"; // Utilisez des guillemets pour gérer les dates avec des espaces ou des caractères spéciaux
    }
    var encodedUri = encodeURI(csvContent);
    var link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "statistiques_reclamations.csv");
    document.body.appendChild(link); // Required for FF
    link.click(); // This will download the data file named "statistiques_reclamations.csv".
});
        });
    </script>
{% endblock %}
